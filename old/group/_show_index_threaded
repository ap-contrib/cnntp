
<%perl>
  my $i;
  my $o_fmt = { map { s/:$//; $_ => $i++ } @{$nntp->overview_fmt} };

  my $max = $group_info[2];
  if ($args{max} > $max) {
    $m->clear_buffer;
    $m->abort(404);
  }
  $max = $args{max} if $args{max} > 0;

  my $articles_per_list = 100;
  my $min = $max > $articles_per_list ? $max - $articles_per_list : 1;

  $m->flush_buffer;

  my $new_max = ($max + $articles_per_list+1 < $group_info[2]) ? ";max=".($max+$articles_per_list+1) : "";
  my @nav = (
    ["Previous", ";max=".($min-1), sub { $min > 1 } ],
    ["Next",     $new_max,         sub { $max < $group_info[2] } ],
    ["Latest",   "",               sub { $max < $group_info[2] } ],
  );
  my $index_navigation = join " | ",
	map { &{$_->[2]} 
               ? qq[<a href="/group/$group$_->[1]">$_->[0]</a>] 
               : $_->[0]
            } @nav;

</%perl>

%  my $xover = $nntp->xover([$min, $max]);

<%perl>
# { 'Subject' => '0', 'Xref:full' => 7, 'References' => 4, 'Lines' => 6, 'From' => 1, 'Date' => 2, 'Bytes' => 5, 'Message-ID' => 3 };
my %containers;
my %id_table;  # msgid->container
my %Messages;

for my $num (reverse $min..$max) {
  $Messages{$num}{subject}=$xover->{$num}->[$o_fmt->{Subject}];
  $Messages{$num}{message_id}=$xover->{$num}->[$o_fmt->{Message-ID}];
  $Messages{$num}{references}=
    [split / /,$xover->{$num}->[$o_fmt->{References}]];
  $id_table{ $Messages{$num}{message_id} } = $num;

  for my $r ( @{$Messages{$num}{references}} ) {
    my $m;
    if (exists $id_table{$r}) {
      $m = $id_table{$r};
    } else {
      $id_table{$r} = 0;
    }

    

  }
  
}

</%perl>

<a href="/group/">Back to group listing</a><br>
<% $group_info[0] %> articles, listing <% $max %>-<% $min %><br>
<% $index_navigation %>
<p>

<table>
<tr>
<td>#</td><td>Subject</td>
<td>Author</td><td>Date</td><td>Lin</td>

</tr>
% use Data::Dumper;
<pre>
<% Dumper($o_fmt) %>
</pre>

% $i = 0;
% for my $num (reverse $min..$max) {
<tr>
<td class="list"><a href="/group/<% $group %>/<% $num %>"><% $num %></a> </td>
% for my $field (qw(Subject From Date Lines)) {
%   my $s = $xover->{$num}->[$o_fmt->{$field}];
%   $s=~s/ .*//, $s=~s/~\@/ at / if $field eq "From";
%   #$s =~ s/[+-].*// if $field eq "Date";
<td class="list"><% $s %></td>
%   unless (++$i % 25) {
%     $m->flush_buffer;
%   }
% }
%#   my $header = $nntp->head($num);

%# <% $header->[0] %><br>

</tr>
% }
</table>

<br>

<% $index_navigation %>


<%args>
  $nntp
  $group
  @group_info
  %args
</%args>
